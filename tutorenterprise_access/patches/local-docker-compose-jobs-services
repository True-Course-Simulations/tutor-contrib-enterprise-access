{% set ENTERPRISE_ACCESS_IMAGE = ENTERPRISE_ACCESS_DOCKER_IMAGE or ENTERPRISE_ACCESS_BUILT_IMAGE %}
enterprise-access-job:
    image: {{ ENTERPRISE_ACCESS_IMAGE }}
    depends_on:
      mysql:
        condition: service_started
      redis:
        condition: service_started
    environment:
      DJANGO_SETTINGS_MODULE: enterprise_access.settings.tutor
      DJANGO_SECRET_KEY: {{ ENTERPRISE_ACCESS_DJANGO_SECRET_KEY }}
      ENTERPRISE_ACCESS_MYSQL_DATABASE: {{ ENTERPRISE_ACCESS_MYSQL_DATABASE }}
      ENTERPRISE_ACCESS_MYSQL_USERNAME: {{ ENTERPRISE_ACCESS_MYSQL_USERNAME }}
      ENTERPRISE_ACCESS_MYSQL_PASSWORD: {{ ENTERPRISE_ACCESS_MYSQL_PASSWORD }}
      ENTERPRISE_ACCESS_MYSQL_HOST: mysql
      ENTERPRISE_ACCESS_MYSQL_PORT: "3306"
      ENTERPRISE_ACCESS_REDIS_HOST: redis
      ENTERPRISE_ACCESS_REDIS_PORT: "6379"
      ENTERPRISE_ACCESS_REDIS_DB: "{{ ENTERPRISE_ACCESS_REDIS_DB }}"
      CELERY_BROKER_URL: "redis://redis:6379/{{ ENTERPRISE_ACCESS_REDIS_DB }}"
      CELERY_RESULT_BACKEND: "redis://redis:6379/{{ ENTERPRISE_ACCESS_REDIS_DB }}"